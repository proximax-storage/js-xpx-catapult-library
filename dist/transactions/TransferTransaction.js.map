{"version":3,"sources":["../../src/transactions/TransferTransaction.js"],"names":["TransferTransactionBufferPackage","require","flatbuffers","address","default","Buffers","TransferTransactionBuffer","MessageBuffer","MosaicBuffer","TransferTransaction","Builder","fee","version","type","deadline","recipient","test","aliasToRecipient","convert","hexToUint8","stringToAddress","message","mosaics","sort","a","b","Number","id","builder","bytePayload","hexEncodedPayload","utf8ToHex","payload","createPayloadVector","startMessageBuffer","addType","addPayload","endMessageBuffer","forEach","createIdVector","mosaic","amount","createAmountVector","startMosaicBuffer","addId","addAmount","push","endMosaicBuffer","signatureVector","createSignatureVector","Array","map","prototype","valueOf","signerVector","createSignerVector","deadlineVector","createDeadlineVector","feeVector","createFeeVector","recipientVector","createRecipientVector","mosaicsVector","createMosaicsVector","startTransferTransactionBuffer","addSize","length","addSignature","addSigner","addVersion","addFee","addDeadline","addRecipient","addNumMosaics","addMessageSize","addMessage","addMosaics","codedTransfer","endTransferTransactionBuffer","finish","bytes","asUint8Array","TransferTransactionSchema","VerifiableTransaction"],"mappings":"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","file":"TransferTransaction.js","sourcesContent":["/*\n * Copyright 2018 NEM\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @module transactions/TransferTransaction\n */\nimport VerifiableTransaction from './VerifiableTransaction';\nimport * as TransferTransactionBufferPackage from '../buffers/TransferTransactionBuffer';\nimport convert from '../coders/convert';\nimport TransferTransactionSchema from '../schema/TransferTransactionSchema';\n\nconst { flatbuffers } = require('flatbuffers');\nconst address = require('../coders/address').default;\n\n\nconst { TransferTransactionBuffer, MessageBuffer, MosaicBuffer } = TransferTransactionBufferPackage.default.Buffers;\n\nexport default class TransferTransaction extends VerifiableTransaction {\n\tstatic get Builder() {\n\t\tclass Builder {\n\t\t\tconstructor() {\n\t\t\t\tthis.fee = [0, 0];\n\t\t\t\tthis.version = 36867;\n\t\t\t\tthis.type = 0x4154;\n\t\t\t}\n\n\t\t\taddFee(fee) {\n\t\t\t\tthis.fee = fee;\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\taddVersion(version) {\n\t\t\t\tthis.version = version;\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\taddType(type) {\n\t\t\t\tthis.type = type;\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\taddDeadline(deadline) {\n\t\t\t\tthis.deadline = deadline;\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\taddRecipient(recipient) {\n\t\t\t\tif (/^[0-9a-fA-F]{16}$/.test(recipient)) {\n\t\t\t\t\t// received hexadecimal notation of namespaceId (alias)\n\t\t\t\t\tthis.recipient = address.aliasToRecipient(convert.hexToUint8(recipient));\n\t\t\t\t} else {\n\t\t\t\t\t// received recipient address\n\t\t\t\t\tthis.recipient = address.stringToAddress(recipient);\n\t\t\t\t}\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\taddMessage(message) {\n\t\t\t\tthis.message = message;\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\taddMosaics(mosaics) {\n\t\t\t\tthis.mosaics = mosaics.sort((a, b) => {\n\t\t\t\t\tif (Number(a.id[1]) > b.id[1]) return 1;\n\t\t\t\t\telse if (a.id[1] < b.id[1]) return -1;\n\t\t\t\t\treturn 0;\n\t\t\t\t});\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tbuild() {\n\t\t\t\tconst builder = new flatbuffers.Builder(1);\n\t\t\t\t// Constants\n\n\t\t\t\t// Create message\n\t\t\t\tconst bytePayload = convert.hexToUint8(this.message.hexEncodedPayload || convert.utf8ToHex(this.message.payload));\n\t\t\t\tconst payload = MessageBuffer.createPayloadVector(builder, bytePayload);\n\t\t\t\tMessageBuffer.startMessageBuffer(builder);\n\t\t\t\tMessageBuffer.addType(builder, this.message.type);\n\t\t\t\tMessageBuffer.addPayload(builder, payload);\n\t\t\t\tconst message = MessageBuffer.endMessageBuffer(builder);\n\n\t\t\t\t// Create mosaics\n\t\t\t\tconst mosaics = [];\n\t\t\t\tthis.mosaics.forEach(mosaic => {\n\t\t\t\t\tconst id = MosaicBuffer.createIdVector(builder, mosaic.id);\n\t\t\t\t\tconst amount = MosaicBuffer.createAmountVector(builder, mosaic.amount);\n\t\t\t\t\tMosaicBuffer.startMosaicBuffer(builder);\n\t\t\t\t\tMosaicBuffer.addId(builder, id);\n\t\t\t\t\tMosaicBuffer.addAmount(builder, amount);\n\t\t\t\t\tmosaics.push(MosaicBuffer.endMosaicBuffer(builder));\n\t\t\t\t});\n\n\t\t\t\t// Create vectors\n\t\t\t\tconst signatureVector = TransferTransactionBuffer\n\t\t\t\t\t.createSignatureVector(builder, Array(...Array(64)).map(Number.prototype.valueOf, 0));\n\t\t\t\tconst signerVector = TransferTransactionBuffer.createSignerVector(builder, Array(...Array(32)).map(Number.prototype.valueOf, 0));\n\t\t\t\tconst deadlineVector = TransferTransactionBuffer.createDeadlineVector(builder, this.deadline);\n\t\t\t\tconst feeVector = TransferTransactionBuffer.createFeeVector(builder, this.fee);\n\t\t\t\tconst recipientVector = TransferTransactionBuffer.createRecipientVector(builder, this.recipient);\n\t\t\t\tconst mosaicsVector = TransferTransactionBuffer.createMosaicsVector(builder, mosaics);\n\n\n\t\t\t\tTransferTransactionBuffer.startTransferTransactionBuffer(builder);\n\t\t\t\tTransferTransactionBuffer.addSize(builder, 149 + (16 * this.mosaics.length) + bytePayload.length);\n\t\t\t\tTransferTransactionBuffer.addSignature(builder, signatureVector);\n\t\t\t\tTransferTransactionBuffer.addSigner(builder, signerVector);\n\t\t\t\tTransferTransactionBuffer.addVersion(builder, this.version);\n\t\t\t\tTransferTransactionBuffer.addType(builder, this.type);\n\t\t\t\tTransferTransactionBuffer.addFee(builder, feeVector);\n\t\t\t\tTransferTransactionBuffer.addDeadline(builder, deadlineVector);\n\t\t\t\tTransferTransactionBuffer.addRecipient(builder, recipientVector);\n\t\t\t\tTransferTransactionBuffer.addNumMosaics(builder, this.mosaics.length);\n\t\t\t\tTransferTransactionBuffer.addMessageSize(builder, bytePayload.length + 1);\n\t\t\t\tTransferTransactionBuffer.addMessage(builder, message);\n\t\t\t\tTransferTransactionBuffer.addMosaics(builder, mosaicsVector);\n\n\n\t\t\t\t// Calculate size\n\n\t\t\t\tconst codedTransfer = TransferTransactionBuffer.endTransferTransactionBuffer(builder);\n\t\t\t\tbuilder.finish(codedTransfer);\n\n\t\t\t\tconst bytes = builder.asUint8Array();\n\t\t\t\treturn new TransferTransaction(bytes, TransferTransactionSchema);\n\t\t\t}\n\t\t}\n\n\t\treturn Builder;\n\t}\n}\n"]}