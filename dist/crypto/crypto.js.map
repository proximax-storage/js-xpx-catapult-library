{"version":3,"sources":["../../src/crypto/crypto.js"],"names":["toMobileKey","password","privateKey","Error","salt","CryptoJS","lib","WordArray","random","key","PBKDF2","keySize","iterations","iv","nacl","randomBytes","encIv","ua2words","encrypted","AES","encrypt","enc","Hex","parse","convert","uint8ToHex","ciphertext","toString","derivePassSha","count","data","console","time","i","SHA3","outputLength","timeEnd","stringify","passwordToPrivatekey","common","walletAccount","algo","r","undefined","pass","obj","hexToUint8","priv","d","decrypt","isHW","hashfunc","dest","dataLength","sha3_512","sha3Hasher","createHasher","reset","update","finalize","key_derive","shared","sk","pk","lowlevel","crypto_shared_key_hash","length","hash","Uint8Array","sha3_256","randomKey","rkey","encKey","encodePrivKey","_encode","senderPriv","recipientPub","msg","hexToUint8Reverse","utf8ToHex","result","_nemencode","bytes","encryptedData","words2ua","sigBytes","mergeArray","nemencrypt","payload","nemdecrypt","recipientPrivate","senderPublic","slice","plain","encode","encoded","decode","_payload","binPayload","buffer","hexplain","ua","uaLength","temp","x","push","create","destUa","cryptowords","v","words","arrays","size","reduce","a","b","byteLength","offset","arr","set","module","exports"],"mappings":"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","file":"crypto.js","sourcesContent":["/*\n * Copyright 2018 NEM\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport convert from '../coders/convert';\nimport nacl from './nacl_catapult';\nimport CryptoJS from 'crypto-js';\nimport sha3Hasher from './sha3Hasher';\n\n/**\n * Encrypt a private key for mobile apps (AES_PBKF2)\n *\n * @param {string} password - A wallet password\n * @param {string} privateKey - An account private key\n *\n * @return {object} - The encrypted data\n */\nlet toMobileKey = function (password, privateKey) {\n    // Errors\n    if (!password || !privateKey) throw new Error('Missing argument !');\n    //if (!Helpers.isPrivateKeyValid(privateKey)) throw new Error('Private key is not valid !');\n    // Processing\n    let salt = CryptoJS.lib.WordArray.random(256 / 8);\n    let key = CryptoJS.PBKDF2(password, salt, {\n        keySize: 256 / 32,\n        iterations: 2000\n    });\n    let iv = nacl.randomBytes(16)\n    let encIv = {\n        iv: ua2words(iv, 16)\n    };\n    let encrypted = CryptoJS.AES.encrypt(CryptoJS.enc.Hex.parse(privateKey), key, encIv);\n    // Result\n    return {\n        encrypted: convert.uint8ToHex(iv) + encrypted.ciphertext,\n        salt: salt.toString()\n    }\n};\n\n/**\n * Derive a private key from a password using count iterations of SHA3-256\n *\n * @param {string} password - A wallet password\n * @param {number} count - A number of iterations above 0\n *\n * @return {object} - The derived private key\n */\nlet derivePassSha = function (password, count) {\n    // Errors\n    if (!password) throw new Error('Missing argument !');\n    if (!count || count <= 0) throw new Error('Please provide a count number above 0');\n    // Processing\n    let data = password;\n    console.time('sha3^n generation time');\n    for (let i = 0; i < count; ++i) {\n        data = CryptoJS.SHA3(data, {\n            outputLength: 256\n        });\n    }\n    console.timeEnd('sha3^n generation time');\n    // Result\n    return {\n        'priv': CryptoJS.enc.Hex.stringify(data)\n    };\n};\n\n/**\n * Reveal the private key of an account or derive it from the wallet password\n *\n * @param {object} common- An object containing password and privateKey field\n * @param {object} walletAccount - A wallet account object\n * @param {string} algo - A wallet algorithm\n *\n * @return {object|boolean} - The account private key in and object or false\n */\nlet passwordToPrivatekey = function (common, walletAccount, algo) {\n    // Errors\n    if (!common || !common.password || !walletAccount || !algo) throw new Error('Missing argument !');\n    // Processing\n    let r = undefined;\n    if (algo === \"pass:6k\") { // Brain wallets\n        if (!walletAccount.encrypted && !walletAccount.iv) {\n            // Account private key is generated simply using a passphrase so it has no encrypted and iv\n            r = derivePassSha(common.password, 6000);\n        } else if (!walletAccount.encrypted || !walletAccount.iv) {\n            // Else if one is missing there is a problem\n            //console.log(\"Account might be compromised, missing encrypted or iv\");\n            return false;\n        } else {\n            // Else child accounts have encrypted and iv so we decrypt\n            let pass = derivePassSha(common.password, 20);\n            let obj = {\n                ciphertext: CryptoJS.enc.Hex.parse(walletAccount.encrypted),\n                iv: convert.hexToUint8(walletAccount.iv),\n                key: convert.hexToUint8(pass.priv)\n            };\n            let d = decrypt(obj);\n            r = { 'priv': d };\n        }\n    } else if (algo === \"pass:bip32\") { // Wallets from PRNG\n        let pass = derivePassSha(common.password, 20);\n        let obj = {\n            ciphertext: CryptoJS.enc.Hex.parse(walletAccount.encrypted),\n            iv: convert.hexToUint8(walletAccount.iv),\n            key: convert.hexToUint8(pass.priv)\n        };\n        let d = decrypt(obj);\n        r = { 'priv': d };\n    } else if (algo === \"pass:enc\") { // Private Key wallets\n        let pass = derivePassSha(common.password, 20);\n        let obj = {\n            ciphertext: CryptoJS.enc.Hex.parse(walletAccount.encrypted),\n            iv: convert.hexToUint8(walletAccount.iv),\n            key: convert.hexToUint8(pass.priv)\n        };\n        let d = decrypt(obj);\n        r = { 'priv': d };\n    } else if (algo === \"trezor\") { // HW wallet\n        r = { 'priv': '' };\n        common.isHW = true;\n    } else {\n        //console.log(\"Unknown wallet encryption method\");\n        return false;\n    }\n    // Result\n    common.privateKey = r.priv;\n    return true;\n}\n\n\nfunction hashfunc(dest, data, dataLength) {\n    // OLD sha3 that uses keccak algo\n    // let convertedData = ua2words(data, dataLength);\n    // let hash = CryptoJS.SHA3(convertedData, {\n    //     outputLength: 512\n    // });\n    // words2ua(dest, hash);\n\n    const sha3_512 = sha3Hasher.createHasher(64);\n    sha3_512.reset();\n    sha3_512.update(data);\n    sha3_512.finalize(dest);\n}\n\nfunction key_derive(shared, salt, sk, pk) {\n    nacl.lowlevel.crypto_shared_key_hash(shared, pk, sk, hashfunc);\n    for (let i = 0; i < salt.length; i++) {\n        shared[i] ^= salt[i];\n    }\n\n    // OLD sha3 that uses keccak algo\n    // let hash = CryptoJS.SHA3(ua2words(shared, 32), {\n    //     outputLength: 256\n    // });\n    // return hash;\n\n    const hash = new Uint8Array(32);\n    const sha3_256 = sha3Hasher.createHasher(32);\n    sha3_256.reset();\n    sha3_256.update(shared);\n    sha3_256.finalize(hash);\n    return ua2words(hash, 32);\n}\n\n/**\n * Generate a random key\n *\n * @return {Uint8Array} - A random key\n */\nlet randomKey = function () {\n    let rkey = nacl.randomBytes(32)\n    return rkey;\n};\n\n/**\n * Encrypt hex data using a key\n *\n * @param {string} data - An hex string\n * @param {Uint8Array} key - An Uint8Array key\n *\n * @return {object} - The encrypted data\n */\nlet encrypt = function (data, key) {\n    // Errors\n    if (!data || !key) throw new Error('Missing argument !');\n    // Processing\n    let iv = nacl.randomBytes(16)\n    let encKey = ua2words(key, 32);\n    let encIv = {\n        iv: ua2words(iv, 16)\n    };\n    let encrypted = CryptoJS.AES.encrypt(CryptoJS.enc.Hex.parse(data), encKey, encIv);\n    // Result\n    return {\n        ciphertext: encrypted.ciphertext,\n        iv: iv,\n        key: key\n    };\n};\n\n/**\n * Decrypt data\n *\n * @param {object} data - An encrypted data object\n *\n * @return {string} - The decrypted hex string\n */\nlet decrypt = function (data) {\n    // Errors\n    if (!data) throw new Error('Missing argument !');\n    // Processing\n    let encKey = ua2words(data.key, 32);\n    let encIv = {\n        iv: ua2words(data.iv, 16)\n    };\n    // Result\n    return CryptoJS.enc.Hex.stringify(CryptoJS.AES.decrypt(data, encKey, encIv));\n};\n\n/**\n * Encode a private key using a password\n *\n * @param {string} privateKey - An hex private key\n * @param {string} password - A password\n *\n * @return {object} - The encoded data\n */\nlet encodePrivKey = function (privateKey, password) {\n    // Errors\n    if (!privateKey || !password) throw new Error('Missing argument !');\n    //if (!Helpers.isPrivateKeyValid(privateKey)) throw new Error('Private key is not valid !');\n    // Processing\n    let pass = derivePassSha(password, 20);\n    let r = encrypt(privateKey, convert.hexToUint8(pass.priv));\n    // Result\n    return {\n        ciphertext: CryptoJS.enc.Hex.stringify(r.ciphertext),\n        iv: convert.uint8ToHex(r.iv)\n    };\n};\n\n/***\n * Encode a message, separated from encode() to help testing\n *\n * @param {string} senderPriv - A sender private key\n * @param {string} recipientPub - A recipient public key\n * @param {string} msg - A text message\n * @param {Uint8Array} iv - An initialization vector\n * @param {Uint8Array} salt - A salt\n *\n * @return {string} - The encoded message\n */\nlet _encode = function (senderPriv, recipientPub, msg, iv, salt) {\n    // Errors\n    if (!senderPriv || !recipientPub || !msg || !iv || !salt) throw new Error('Missing argument !');\n    //if (!Helpers.isPrivateKeyValid(senderPriv)) throw new Error('Private key is not valid !');\n    //if (!Helpers.isPublicKeyValid(recipientPub)) throw new Error('Public key is not valid !');\n    // Processing\n    let sk = convert.hexToUint8Reverse(senderPriv);\n    let pk = convert.hexToUint8(recipientPub);\n    let shared = new Uint8Array(32);\n    let r = key_derive(shared, salt, sk, pk);\n    let encKey = r;\n    let encIv = {\n        iv: ua2words(iv, 16)\n    };\n    let encrypted = CryptoJS.AES.encrypt(CryptoJS.enc.Hex.parse(convert.utf8ToHex(msg)), encKey, encIv);\n    // Result\n    let result = convert.uint8ToHex(salt) + convert.uint8ToHex(iv) + CryptoJS.enc.Hex.stringify(encrypted.ciphertext);\n    return result;\n};\n\n/**\n *\n * @param {string} senderPriv\n * @param {string} recipientPub\n * @param {Uint8Array} bytes\n * @param {Uint8Array} iv\n * @param {Uint8Array} salt\n */\nlet _nemencode = function (senderPriv, recipientPub, bytes, iv, salt) {\n    if (!senderPriv || !recipientPub || !bytes || !iv || !salt) throw new Error('Missing argument !');\n\n    let sk = convert.hexToUint8Reverse(senderPriv);\n    let pk = convert.hexToUint8(recipientPub);\n    let shared = new Uint8Array(32);\n    let r = key_derive(shared, salt, sk, pk);\n    /* console.log('key ' + r);\n     console.log('salt ' + salt);\n     console.log('iv ' + iv);\n     console.log('payload ' + bytes)*/\n    let encKey = r;\n    let encIv = {\n        iv: ua2words(iv, 16)\n    };\n\n    let data = ua2words(bytes, bytes.length);\n    //let data = convertUint8ArrayToWordArray(bytes);\n    //console.log(\"Converted input bytes to wordArray \");\n    //console.log(data);\n\n    let encrypted = CryptoJS.AES.encrypt(data, encKey, encIv);\n    //console.log(encrypted.ciphertext.sigBytes);\n\n    // convert to Uint8Array\n    let encryptedData = words2ua(new Uint8Array(encrypted.ciphertext.sigBytes), encrypted.ciphertext);\n\n    // merge salt , iv and encrypted data in Uint8Array\n    let result = mergeArray(salt, iv, encryptedData);\n    //console.log(\"Merged salt iv and ciphertext\");\n    //console.log(result);\n    return result;\n}\n\n/**\n * Encrypt data using nem keys\n * @param {string} senderPriv A sender private key\n * @param {string} recipientPub A recipient public key\n * @param {Uint8Array} bytes the array of bytes in Uint8Array\n */\nlet nemencrypt = function (senderPriv, recipientPub, bytes) {\n    // Errors\n    if (!senderPriv || !recipientPub || !bytes) throw new Error('Missing argument !');\n\n    // Processing\n    let iv = nacl.randomBytes(16);\n    let salt = nacl.randomBytes(32);\n\n    // OLD - no need to reverse private key\n    // let sk = convert.hexToUint8Reverse(senderPriv);\n    let sk = convert.hexToUint8(senderPriv);\n    let pk = convert.hexToUint8(recipientPub);\n    let shared = new Uint8Array(32);\n    let r = key_derive(shared, salt, sk, pk);\n    let encKey = r;\n    let encIv = {\n        iv: ua2words(iv, 16)\n    };\n\n    let payload = ua2words(bytes, bytes.length);\n    let encrypted = CryptoJS.AES.encrypt(payload, encKey, encIv);\n    let encryptedData = words2ua(new Uint8Array(encrypted.ciphertext.sigBytes), encrypted.ciphertext);\n    let result = mergeArray(salt, iv, encryptedData);\n\n    // Result\n    return result;\n};\n\n/**\n *\n * @param {string} recipientPrivate the recipient private key\n * @param {string} senderPublic the recipient public key\n * @param {Uint8Array} bytes the array of bytes in Uint8Array\n */\nlet nemdecrypt = function (recipientPrivate, senderPublic, bytes) {\n    // Errorsp\n    if (!recipientPrivate || !senderPublic || !bytes) throw new Error('Missing argument !');\n\n    // Processing\n    let salt = bytes.slice(0, 32);\n    let iv = bytes.slice(32, 48);\n    let payload = bytes.slice(48, bytes.length);\n\n    // OLD - no need to reverse private key\n    // let sk = convert.hexToUint8Reverse(recipientPrivate);\n    let sk = convert.hexToUint8(recipientPrivate);\n    let pk = convert.hexToUint8(senderPublic);\n    let shared = new Uint8Array(32);\n    let r = key_derive(shared, salt, sk, pk);\n\n    let encKey = r;\n    let encIv = {\n        iv: ua2words(iv, 16)\n    };\n\n    let encrypted = {\n        'ciphertext': ua2words(payload, payload.length)\n    };\n\n    let plain = CryptoJS.AES.decrypt(encrypted, encKey, encIv);\n\n    let result = words2ua(new Uint8Array(plain.sigBytes), plain);\n\n    // Result\n    return result;\n\n};\n\n/**\n * Encode a message\n *\n * @param {string} senderPriv - A sender private key\n * @param {string} recipientPub - A recipient public key\n * @param {string} msg - A text message\n *\n * @return {string} - The encoded message\n */\nlet encode = function (senderPriv, recipientPub, msg) {\n    // Errors\n    if (!senderPriv || !recipientPub || !msg) throw new Error('Missing argument !');\n    //if (!Helpers.isPrivateKeyValid(senderPriv)) throw new Error('Private key is not valid !');\n    //if (!Helpers.isPublicKeyValid(recipientPub)) throw new Error('Public key is not valid !');\n    // Processing\n    let iv = nacl.randomBytes(16)\n    //console.log(\"IV:\", convert.uint8ToHex(iv));\n    let salt = nacl.randomBytes(32)\n    let encoded = _encode(senderPriv, recipientPub, msg, iv, salt);\n    // Result\n    return encoded;\n};\n\n/**\n * Decode an encrypted message payload\n *\n * @param {string} recipientPrivate - A recipient private key\n * @param {string} senderPublic - A sender public key\n * @param {string} _payload - An encrypted message payload\n *\n * @return {string} - The decoded payload as hex\n */\nlet decode = function (recipientPrivate, senderPublic, _payload) {\n    // Errorsp\n    if (!recipientPrivate || !senderPublic || !_payload) throw new Error('Missing argument !');\n    //if (!Helpers.isPrivateKeyValid(recipientPrivate)) throw new Error('Private key is not valid !');\n    //if (!Helpers.isPublicKeyValid(senderPublic)) throw new Error('Public key is not valid !');\n    // Processing\n    let binPayload = convert.hexToUint8(_payload);\n    let salt = new Uint8Array(binPayload.buffer, 0, 32);\n    let iv = new Uint8Array(binPayload.buffer, 32, 16);\n    let payload = new Uint8Array(binPayload.buffer, 48);\n    let sk = convert.hexToUint8Reverse(recipientPrivate);\n    let pk = convert.hexToUint8(senderPublic);\n    let shared = new Uint8Array(32);\n    let r = key_derive(shared, salt, sk, pk);\n    let encKey = r;\n    let encIv = {\n        iv: ua2words(iv, 16)\n    };\n    let encrypted = {\n        'ciphertext': ua2words(payload, payload.length)\n    };\n    let plain = CryptoJS.AES.decrypt(encrypted, encKey, encIv);\n    // Result\n    let hexplain = CryptoJS.enc.Hex.stringify(plain);\n    return hexplain;\n};\n\n/**\n * Convert an Uint8Array to WordArray\n *\n * @param {Uint8Array} ua - An Uint8Array\n * @param {number} uaLength - The Uint8Array length\n *\n * @return {WordArray}\n */\nlet ua2words = function (ua, uaLength) {\n    let temp = [];\n    for (let i = 0; i < uaLength; i += 4) {\n        let x = ua[i] * 0x1000000 + (ua[i + 1] || 0) * 0x10000 + (ua[i + 2] || 0) * 0x100 + (ua[i + 3] || 0);\n        temp.push((x > 0x7fffffff) ? x - 0x100000000 : x);\n    }\n    return CryptoJS.lib.WordArray.create(temp, uaLength);\n}\n\n/**\n * Convert a wordArray to Uint8Array\n *\n * @param {Uint8Array} destUa - A destination Uint8Array\n * @param {WordArray} cryptowords - A wordArray\n *\n * @return {Uint8Array}\n */\nlet words2ua = function (destUa, cryptowords) {\n    for (let i = 0; i < destUa.length; i += 4) {\n        let v = cryptowords.words[i / 4];\n        if (v < 0) v += 0x100000000;\n        destUa[i] = (v >>> 24);\n        destUa[i + 1] = (v >>> 16) & 0xff;\n        destUa[i + 2] = (v >>> 8) & 0xff;\n        destUa[i + 3] = v & 0xff;\n    }\n    return destUa;\n}\n\nlet mergeArray = function (...arrays) {\n    let size = arrays.reduce((a, b) => a + b.byteLength, 0)\n    // Allcolate a new buffer\n    let result = new Uint8Array(size)\n\n    // Build the new array\n    let offset = 0\n    for (let arr of arrays) {\n        result.set(arr, offset)\n        offset += arr.byteLength\n    }\n\n    return result\n}\n\nmodule.exports = {\n    toMobileKey,\n    derivePassSha,\n    passwordToPrivatekey,\n    randomKey,\n    decrypt,\n    encrypt,\n    encodePrivKey,\n    _encode,\n    encode,\n    decode,\n    nemencrypt,\n    nemdecrypt,\n}\n"]}